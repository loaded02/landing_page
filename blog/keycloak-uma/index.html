<!DOCTYPE html>
    <html lang="de">
      <head>
        <link rel="stylesheet" type="text/css" href="/assets/static/pages_Layout-69d9ce51.H2omG36N.css">
        <link rel="stylesheet" type="text/css" href="/assets/static/pages_tailwind-65fb2459.DVh4hPkJ.css">
        <meta charset="UTF-8" />
        
        
    <title>Hilberg IT Beratung - Software Developers &amp; Architects</title><meta property="og:title" content="Hilberg IT Beratung - Software Developers &amp; Architects" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="icon" href="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICAgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiB2aWV3Qm94PSIwIDAgNjQgNjQiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iRGV2ZWxvcGVyIGxvZ28iPgogICAgPCEtLSBiYWNrZ3JvdW5kIHJvdW5kZWQgdGlsZSAtLT4KICAgIDxyZWN0IHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgcng9IjEyIiByeT0iMTIiIGZpbGw9IiMwZWE1YTQiLz4KICAgIDwhLS0gc3VidGxlIGlubmVyIGhpZ2hsaWdodCAtLT4KICAgIDxwYXRoIGQ9Ik00IDIwIFEzMiA0IDYwIDIwIEw2MCA0NCBRMzIgNjAgNCA0NCBaIiBmaWxsPSIjZmZmZmZmIiBvcGFjaXR5PSIwLjA0Ii8+CiAgICA8IS0tIGNvZGUgbWFyayAtLT4KICAgIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0ibW9ub3NwYWNlLCB1aS1tb25vc3BhY2UsIFNGTW9uby1SZWd1bGFyLCBNZW5sbywgJ1JvYm90byBNb25vJywgbW9ub3NwYWNlIgogICAgICAgICAgZm9udC1zaXplPSIyNiIgZmlsbD0iI2ZmZmZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9ImNlbnRyYWwiIGZvbnQtd2VpZ2h0PSI3MDAiPgogICAgICAgICZsdDsvJmd0OwogICAgPC90ZXh0Pgo8L3N2Zz4K" type="image/svg+xml"/><link rel="canonical" href="https://www.hilberg-it.de"/><meta property="og:type" content="website"/><meta property="og:locale" content="de_DE"/><meta property="og:image:alt" content="Icon of Hilberg IT Beratung"/><meta property="og:image:width" content="499"/><meta property="og:image:height" content="484"/><meta property="og:url" content="https://www.hilberg-it.de"/><meta property="og:site_name" content="Hilberg IT Beratung - Software Developers &amp; Architects"/><meta name="twitter:creator" content="Hilberg IT Beratung"/><meta name="twitter:image:alt" content="Icon of Hilberg IT Beratung"/><meta name="keywords" content="Softwareentwicklung, IT-Beratung, Softwarearchitektur, skalierbare Systeme"/><meta name="author" content="Hilberg IT Beratung"/><meta name="robots" content="index, follow"/><meta name="theme-color" content="#ffffff"/><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://www.hilberg-it.de/#organization","name":"Hilberg IT Beratung","url":"https://www.hilberg-it.de/","logo":{"@type":"ImageObject","url":"https://www.hilberg-it.de/favicon.svg"}},{"@type":"WebSite","@id":"https://www.hilberg-it.de/#website","name":"Hilberg IT Beratung","url":"https://www.hilberg-it.de/","inLanguage":"de-DE","publisher":{"@id":"https://www.hilberg-it.de/#organization"}},{"@type":"WebPage","@id":"https://www.hilberg-it.de/#webpage","url":"https://www.hilberg-it.de/","name":"Hilberg IT Beratung - Software Developers & Architects","isPartOf":{"@id":"https://www.hilberg-it.de/#website"},"about":{"@id":"https://www.hilberg-it.de/#software"}}]}</script>
    
    <meta name="description" content="Software Developers &amp; Architects specializing in scalable systems and elegant solutions" /><meta property="og:description" content="Software Developers &amp; Architects specializing in scalable systems and elegant solutions" />
    <meta property="og:image" content="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICAgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiB2aWV3Qm94PSIwIDAgNjQgNjQiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iRGV2ZWxvcGVyIGxvZ28iPgogICAgPCEtLSBiYWNrZ3JvdW5kIHJvdW5kZWQgdGlsZSAtLT4KICAgIDxyZWN0IHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgcng9IjEyIiByeT0iMTIiIGZpbGw9IiMwZWE1YTQiLz4KICAgIDwhLS0gc3VidGxlIGlubmVyIGhpZ2hsaWdodCAtLT4KICAgIDxwYXRoIGQ9Ik00IDIwIFEzMiA0IDYwIDIwIEw2MCA0NCBRMzIgNjAgNCA0NCBaIiBmaWxsPSIjZmZmZmZmIiBvcGFjaXR5PSIwLjA0Ii8+CiAgICA8IS0tIGNvZGUgbWFyayAtLT4KICAgIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0ibW9ub3NwYWNlLCB1aS1tb25vc3BhY2UsIFNGTW9uby1SZWd1bGFyLCBNZW5sbywgJ1JvYm90byBNb25vJywgbW9ub3NwYWNlIgogICAgICAgICAgZm9udC1zaXplPSIyNiIgZmlsbD0iI2ZmZmZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9ImNlbnRyYWwiIGZvbnQtd2VpZ2h0PSI3MDAiPgogICAgICAgICZsdDsvJmd0OwogICAgPC90ZXh0Pgo8L3N2Zz4K"><meta name="twitter:card" content="summary_large_image">
  
        
      </head>
      <body>
        
        <div id="root"><div class="bg-white text-gray-900 antialiased"><nav class="fixed top-0 w-full bg-white/80 backdrop-blur-sm z-50 border-b border-gray-100"><div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center"><a href="/" class="text-lg font-semibold flex items-center gap-2"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICAgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiB2aWV3Qm94PSIwIDAgNjQgNjQiIHJvbGU9ImltZyIgYXJpYS1sYWJlbD0iRGV2ZWxvcGVyIGxvZ28iPgogICAgPCEtLSBiYWNrZ3JvdW5kIHJvdW5kZWQgdGlsZSAtLT4KICAgIDxyZWN0IHdpZHRoPSI2NCIgaGVpZ2h0PSI2NCIgcng9IjEyIiByeT0iMTIiIGZpbGw9IiMwZWE1YTQiLz4KICAgIDwhLS0gc3VidGxlIGlubmVyIGhpZ2hsaWdodCAtLT4KICAgIDxwYXRoIGQ9Ik00IDIwIFEzMiA0IDYwIDIwIEw2MCA0NCBRMzIgNjAgNCA0NCBaIiBmaWxsPSIjZmZmZmZmIiBvcGFjaXR5PSIwLjA0Ii8+CiAgICA8IS0tIGNvZGUgbWFyayAtLT4KICAgIDx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0ibW9ub3NwYWNlLCB1aS1tb25vc3BhY2UsIFNGTW9uby1SZWd1bGFyLCBNZW5sbywgJ1JvYm90byBNb25vJywgbW9ub3NwYWNlIgogICAgICAgICAgZm9udC1zaXplPSIyNiIgZmlsbD0iI2ZmZmZmZiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZG9taW5hbnQtYmFzZWxpbmU9ImNlbnRyYWwiIGZvbnQtd2VpZ2h0PSI3MDAiPgogICAgICAgICZsdDsvJmd0OwogICAgPC90ZXh0Pgo8L3N2Zz4K" alt="Hilberg IT Logo" class="w-6 h-6"/>Hilberg IT Beratung</a><div class="hidden md:flex items-center space-x-6 ml-auto mr-8"><a href="/blog" class="link-hover text-sm text-gray-600 hover:text-gray-900">Blog</a><a href="/#about" class="link-hover text-sm text-gray-600 hover:text-gray-900">Über uns</a><a href="/#work" class="link-hover text-sm text-gray-600 hover:text-gray-900">Projekte</a><a href="/#contact" class="link-hover text-sm text-gray-600 hover:text-gray-900">Kontakt</a></div><div class="flex items-center gap-4"><div class="flex gap-2 text-sm font-medium"></div><button class="md:hidden flex flex-col gap-1.5 w-6 h-6 justify-center" aria-label="Toggle menu"><span class="block h-0.5 w-full bg-gray-900 transition-transform "></span><span class="block h-0.5 w-full bg-gray-900 transition-opacity "></span><span class="block h-0.5 w-full bg-gray-900 transition-transform "></span></button></div></div><div class="md:hidden hidden bg-white/95 backdrop-blur-sm border-t border-gray-100"><div class="px-6 py-4 flex flex-col space-y-4"><a href="/blog" class="link-hover text-sm text-gray-600 hover:text-gray-900">Blog</a><a href="/#about" class="link-hover text-sm text-gray-600 hover:text-gray-900">Über uns</a><a href="/#work" class="link-hover text-sm text-gray-600 hover:text-gray-900">Projekte</a><a href="/#contact" class="link-hover text-sm text-gray-600 hover:text-gray-900">Kontakt</a></div></div></nav><div class="max-w-4xl mx-auto px-6 py-20"><a href="/blog" class="text-blue-600 hover:text-blue-800 mb-6 inline-block">← Back to Blog</a><article class="prose prose-lg max-w-none"><div class="text-sm text-gray-500 mb-2">September 1, 2021</div><h1 class="text-4xl font-medium mb-6">Fine-Grained Authorization with Keycloak UMA: Building Dynamic Resource Access Control</h1><p class="text-xl text-gray-600 mb-8">Modern applications increasingly require sophisticated authorization mechanisms that go beyond simple role-based access control. Learn how to architect a system where users dynamically create resources and manage fine-grained permissions through Keycloak&#x27;s User-Managed Access (UMA) 2.0 implementation.</p><h2 class="text-2xl font-medium mt-8 mb-4">The Use Case</h2><p class="mb-4">Consider a multi-tenant SaaS platform where users dynamically create resources—documents, projects, or in our case, car records—and need granular control over who can access them. Our application has the following requirements:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2">A backend server creates car resources dynamically at runtime</li><li class="mb-2">Each car resource should be individually protected</li><li class="mb-2">Resource owners need a self-service interface to grant read/write permissions</li><li class="mb-2">Authorization decisions combine attribute-based (ABAC) and role-based (RBAC) policies</li><li class="mb-2">The solution must scale to thousands of dynamically created resources</li></ul><h2 class="text-2xl font-medium mt-8 mb-4">Understanding Keycloak&#x27;s Authorization Architecture</h2><p class="mb-4">Before diving into implementation, let&#x27;s clarify Keycloak&#x27;s authorization primitives:</p><h3 class="text-xl font-medium mt-6 mb-3">Resource Server</h3><p class="mb-4">The resource server is the application you&#x27;re protecting—in our case, the backend API that manages car resources. In Keycloak, you register your API as a client with &quot;Authorization Enabled&quot; turned on. This transforms a standard OAuth2/OIDC client into a resource server capable of enforcing fine-grained permissions.</p><p class="mb-4">When you enable authorization for a client, Keycloak provisions an authorization configuration for that resource server, including dedicated endpoints for managing resources, scopes, policies, and permissions.</p><h3 class="text-xl font-medium mt-6 mb-3">Resources</h3><p class="mb-4">Resources represent the protected objects in your system. In our scenario, each car is a resource. Resources can be registered programmatically via Keycloak&#x27;s Protection API, which is critical for dynamic scenarios.</p><p class="mb-4">A resource definition includes:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2"><strong>Name and URI:</strong> Logical identifier and optional URI pattern (e.g., <code>/car/123</code>)</li><li class="mb-2"><strong>Type:</strong> Optional categorization (e.g., <code>urn:myapp:resources:car</code>)</li><li class="mb-2"><strong>Scopes:</strong> Associated actions that can be performed</li><li class="mb-2"><strong>Owner:</strong> The user who owns this resource (crucial for UMA)</li><li class="mb-2"><strong>Attributes:</strong> Custom metadata for policy evaluation</li></ul><h3 class="text-xl font-medium mt-6 mb-3">Scopes</h3><p class="mb-4">Scopes define the actions that can be performed on resources. For our use case, we define two scopes:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2"><code>car:read</code>: View car details</li><li class="mb-2"><code>car:write</code>: Modify car details</li></ul><p class="mb-4">Scopes are defined at the resource server level and can be associated with any resource. This allows consistent permission semantics across all car resources.</p><h3 class="text-xl font-medium mt-6 mb-3">Policies</h3><p class="mb-4">Policies are the conditions that must be satisfied for access to be granted. Keycloak supports several policy types:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2"><strong>Role Policy (RBAC):</strong> Grant access based on realm or client roles</li><li class="mb-2"><strong>User Policy:</strong> Grant access to specific users</li><li class="mb-2"><strong>Attribute Policy (ABAC):</strong> Evaluate custom attributes from the token or context</li><li class="mb-2"><strong>JavaScript Policy:</strong> Custom logic using JavaScript</li><li class="mb-2"><strong>Time Policy:</strong> Temporal access restrictions</li><li class="mb-2"><strong>Aggregated Policy:</strong> Combine multiple policies with AND/OR logic</li></ul><p class="mb-4">For our implementation, we&#x27;ll combine role-based and attribute-based policies to create sophisticated authorization rules.</p><h3 class="text-xl font-medium mt-6 mb-3">Permissions</h3><p class="mb-4">Permissions bind resources and scopes to policies. They answer the question: &quot;Under what policy conditions can a scope be performed on a resource?&quot;</p><p class="mb-4">Keycloak supports two permission types:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2"><strong>Resource-based permissions:</strong> Apply to specific resources or resource types</li><li class="mb-2"><strong>Scope-based permissions:</strong> Apply to scopes across multiple resources</li></ul><h2 class="text-2xl font-medium mt-8 mb-4">Technical Implementation</h2><h3 class="text-xl font-medium mt-6 mb-3">Step 1: Configure the Resource Server</h3><p class="mb-4">First, create a client in Keycloak that represents your backend API:</p><pre class="bg-gray-100 p-4 rounded-lg mb-4 overflow-x-auto">{
  &quot;clientId&quot;: &quot;car-api&quot;,
  &quot;protocol&quot;: &quot;openid-connect&quot;,
  &quot;publicClient&quot;: false,
  &quot;authorizationServicesEnabled&quot;: true,
  &quot;serviceAccountsEnabled&quot;: true,
  &quot;standardFlowEnabled&quot;: false,
  &quot;directAccessGrantsEnabled&quot;: false
}</pre><p class="mb-4">The <code>serviceAccountsEnabled</code> flag is crucial—it allows your backend to authenticate with Keycloak to register resources dynamically using client credentials.</p><h3 class="text-xl font-medium mt-6 mb-3">Step 2: Define Scopes</h3><p class="mb-4">In the Keycloak admin console, navigate to your resource server&#x27;s Authorization settings and define scopes:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2">Name: <code>car:read</code>, Display Name: &quot;Read Car&quot;</li><li class="mb-2">Name: <code>car:write</code>, Display Name: &quot;Write Car&quot;</li></ul><h3 class="text-xl font-medium mt-6 mb-3">Step 3: Dynamic Resource Registration</h3><p class="mb-4">When your server creates a new car, it must register the resource with Keycloak using the Protection API. Here&#x27;s the flow:</p><pre class="bg-gray-100 p-4 rounded-lg mb-4 overflow-x-auto text-sm">import org.keycloak.authorization.client.AuthzClient;
import org.keycloak.authorization.client.Configuration;
import org.keycloak.representations.idm.authorization.ResourceRepresentation;
import org.keycloak.representations.idm.authorization.ScopeRepresentation;

import java.util.*;

public class KeycloakResourceManager {

    private final AuthzClient authzClient;

    public KeycloakResourceManager(String serverUrl, String realm,
                                   String clientId, String clientSecret) {
        Map&lt;String, Object&gt; credentials = new HashMap&lt;&gt;();
        credentials.put(&quot;secret&quot;, clientSecret);

        Configuration configuration = new Configuration(
            serverUrl,
            realm,
            clientId,
            credentials,
            null
        );

        this.authzClient = AuthzClient.create(configuration);
    }

    public String registerResource(String carId, String ownerId,
                                   Map&lt;String, String&gt; carAttributes) {
        ResourceRepresentation resource = new ResourceRepresentation();
        resource.setName(&quot;Car &quot; + carId);
        resource.setType(&quot;urn:car-api:resources:car&quot;);
        resource.setUri(&quot;/car/&quot; + carId);
        resource.setOwner(ownerId);
        resource.setOwnerManagedAccess(true); // Enable UMA

        // Define scopes for this resource
        Set&lt;ScopeRepresentation&gt; scopes = new HashSet&lt;&gt;();
        scopes.add(new ScopeRepresentation(&quot;car:read&quot;));
        scopes.add(new ScopeRepresentation(&quot;car:write&quot;));
        resource.setScopes(scopes);

        // Add custom attributes for ABAC policies
        Map&lt;String, List&lt;String&gt;&gt; attributes = new HashMap&lt;&gt;();
        attributes.put(&quot;manufacturer&quot;,
            Collections.singletonList(carAttributes.get(&quot;manufacturer&quot;)));
        attributes.put(&quot;category&quot;,
            Collections.singletonList(carAttributes.get(&quot;category&quot;)));
        attributes.put(&quot;year&quot;,
            Collections.singletonList(String.valueOf(carAttributes.get(&quot;year&quot;))));
        resource.setAttributes(attributes);

        // Register with Keycloak
        ResourceRepresentation created = authzClient
            .protection()
            .resource()
            .create(resource);

        return created.getId(); // Keycloak&#x27;s internal resource ID
    }

    public void deleteResource(String resourceId) {
        authzClient.protection().resource().delete(resourceId);
    }
}</pre><p class="mb-4">The critical field here is <code>setOwnerManagedAccess(true)</code>, which enables UMA for this resource, allowing the owner to manage permissions independently.</p><h3 class="text-xl font-medium mt-6 mb-3">Step 4: Create Base Policies</h3><p class="mb-4">Define policies that will be referenced by permissions. In the Keycloak admin console:</p><p class="mb-4"><strong>Admin Role Policy (RBAC)</strong>:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2">Type: Role</li><li class="mb-2">Name: <code>admin-role-policy</code></li><li class="mb-2">Realm roles: <code>admin</code></li><li class="mb-2">Logic: Positive</li></ul><p class="mb-4"><strong>Owner Policy (ABAC)</strong>:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2">Type: JavaScript</li><li class="mb-2">Name: <code>resource-owner-policy</code></li><li class="mb-2">Code:</li></ul><pre class="bg-gray-100 p-4 rounded-lg mb-4 overflow-x-auto text-sm">var context = $evaluation.getContext();
var identity = context.getIdentity();
var resource = $evaluation.getPermission().getResource();

if (resource.getOwner().equals(identity.getId())) {
    $evaluation.grant();
}</pre><p class="mb-4"><strong>Premium User Read Policy (ABAC)</strong>:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2">Type: Attribute</li><li class="mb-2">Name: <code>premium-user-read-policy</code></li><li class="mb-2">Condition: User attribute <code>subscription</code> equals <code>premium</code></li></ul><h3 class="text-xl font-medium mt-6 mb-3">Step 5: Define Default Permissions</h3><p class="mb-4">Create resource-based permissions that apply to all car resources:</p><p class="mb-4"><strong>Admin Full Access</strong>:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2">Name: <code>admin-full-access-permission</code></li><li class="mb-2">Resource Type: <code>urn:car-api:resources:car</code></li><li class="mb-2">Scopes: <code>car:read</code>, <code>car:write</code></li><li class="mb-2">Policies: <code>admin-role-policy</code></li><li class="mb-2">Decision Strategy: Unanimous</li></ul><p class="mb-4"><strong>Owner Full Access</strong>:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2">Name: <code>owner-full-access-permission</code></li><li class="mb-2">Resource Type: <code>urn:car-api:resources:car</code></li><li class="mb-2">Scopes: <code>car:read</code>, <code>car:write</code></li><li class="mb-2">Policies: <code>resource-owner-policy</code></li><li class="mb-2">Decision Strategy: Unanimous</li></ul><p class="mb-4"><strong>Premium Read Access</strong>:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2">Name: <code>premium-read-permission</code></li><li class="mb-2">Resource Type: <code>urn:car-api:resources:car</code></li><li class="mb-2">Scopes: <code>car:read</code></li><li class="mb-2">Policies: <code>premium-user-read-policy</code></li><li class="mb-2">Decision Strategy: Affirmative</li></ul><h3 class="text-xl font-medium mt-6 mb-3">Step 6: Enforce Authorization in Your API</h3><p class="mb-4">When a request arrives at your API, you must request an authorization decision from Keycloak:</p><pre class="bg-gray-100 p-4 rounded-lg mb-4 overflow-x-auto text-sm">import org.keycloak.authorization.client.AuthzClient;
import org.keycloak.authorization.client.resource.AuthorizationResource;
import org.keycloak.representations.idm.authorization.AuthorizationRequest;
import org.keycloak.representations.idm.authorization.AuthorizationResponse;

import javax.ws.rs.*;
import javax.ws.rs.core.Response;

@Path(&quot;/car&quot;)
public class CarResource {

    private final AuthzClient authzClient;

    public CarResource(AuthzClient authzClient) {
        this.authzClient = authzClient;
    }

    @GET
    @Path(&quot;/{carId}&quot;)
    @Produces(&quot;application/json&quot;)
    public Response getCar(@PathParam(&quot;carId&quot;) String carId,
                          @HeaderParam(&quot;Authorization&quot;) String authorizationHeader) {

        String accessToken = extractToken(authorizationHeader);

        // Check permission with Keycloak
        if (!checkPermission(accessToken, &quot;/car/&quot; + carId, &quot;car:read&quot;)) {
            return Response.status(Response.Status.FORBIDDEN)
                .entity(&quot;Access denied&quot;)
                .build();
        }

        // Fetch and return car data
        Car car = fetchCarFromDatabase(carId);
        return Response.ok(car).build();
    }

    @PUT
    @Path(&quot;/{carId}&quot;)
    @Consumes(&quot;application/json&quot;)
    @Produces(&quot;application/json&quot;)
    public Response updateCar(@PathParam(&quot;carId&quot;) String carId,
                             @HeaderParam(&quot;Authorization&quot;) String authorizationHeader,
                             Car updatedCar) {

        String accessToken = extractToken(authorizationHeader);

        // Check permission with Keycloak
        if (!checkPermission(accessToken, &quot;/car/&quot; + carId, &quot;car:write&quot;)) {
            return Response.status(Response.Status.FORBIDDEN)
                .entity(&quot;Access denied&quot;)
                .build();
        }

        // Update car data
        updateCarInDatabase(carId, updatedCar);
        return Response.ok().entity(&quot;{\&quot;status\&quot;: \&quot;updated\&quot;}&quot;).build();
    }

    private boolean checkPermission(String accessToken, String resourceUri,
                                   String scope) {
        try {
            AuthorizationRequest request = new AuthorizationRequest();
            request.addPermission(resourceUri, scope);

            AuthorizationResponse response = authzClient
                .authorization(accessToken)
                .authorize(request);

            // If we get a response, permission is granted
            return response.getToken() != null;

        } catch (Exception e) {
            // Authorization denied or error occurred
            return false;
        }
    }

    private String extractToken(String authorizationHeader) {
        if (authorizationHeader != null &amp;&amp; authorizationHeader.startsWith(&quot;Bearer &quot;)) {
            return authorizationHeader.substring(7);
        }
        throw new WebApplicationException(&quot;Missing or invalid authorization header&quot;,
            Response.Status.UNAUTHORIZED);
    }
}</pre><p class="mb-4">The authorization flow here uses the UMA grant type, which evaluates all policies and permissions associated with the requested resource and scope.</p><h3 class="text-xl font-medium mt-6 mb-3">Step 7: Leverage Keycloak&#x27;s Built-in UMA Account Console</h3><p class="mb-4">Keycloak provides a built-in Account Console with User-Managed Access capabilities that allows resource owners to manage permissions without any custom development. This is one of the most powerful features of Keycloak&#x27;s UMA implementation.</p><p class="mb-4"><strong>Enabling the Account Console</strong>:</p><p class="mb-4">The Account Console is available by default at:</p><pre class="bg-gray-100 p-4 rounded-lg mb-4 overflow-x-auto">https://&lt;keycloak-server&gt;/realms/&lt;realm-name&gt;/account</pre><p class="mb-4">Once users log in to the Account Console, they can navigate to the &quot;Resources&quot; or &quot;My Resources&quot; section, where they&#x27;ll see:</p><ol class="list-decimal pl-6 mb-4"><li class="mb-2"><strong>All resources they own:</strong> Every resource registered with <code>ownerManagedAccess: true</code> and their user ID as owner</li><li class="mb-2"><strong>Resource details:</strong> Name, type, URI, and available scopes</li><li class="mb-2"><strong>Current permissions:</strong> List of users who have been granted access and their specific scopes</li><li class="mb-2"><strong>Share functionality:</strong> UI to grant new permissions to other users</li></ol><p class="mb-4"><strong>How it works</strong>:</p><p class="mb-4">When a resource owner wants to share access:</p><ol class="list-decimal pl-6 mb-4"><li class="mb-2">They navigate to their resource in the Account Console</li><li class="mb-2">Click &quot;Share&quot; or &quot;Add Permission&quot;</li><li class="mb-2">Enter the username or email of the user they want to grant access to</li><li class="mb-2">Select which scopes to grant (e.g., <code>car:read</code>, <code>car:write</code>)</li><li class="mb-2">Submit the permission</li></ol><p class="mb-4">Behind the scenes, Keycloak creates a UMA permission ticket that binds the resource, the requester, and the granted scopes.</p><p class="mb-4"><strong>Deep Linking from Your Application</strong>:</p><p class="mb-4">You can provide direct links from your application to the relevant sections of the Account Console:</p><pre class="bg-gray-100 p-4 rounded-lg mb-4 overflow-x-auto text-sm">public class AccountConsoleConfig {

    private final String keycloakUrl;
    private final String realm;

    public AccountConsoleConfig(String keycloakUrl, String realm) {
        this.keycloakUrl = keycloakUrl;
        this.realm = realm;
    }

    public String getAccountConsoleUrl() {
        return String.format(&quot;%s/realms/%s/account&quot;, keycloakUrl, realm);
    }

    public String getMyResourcesUrl() {
        return String.format(&quot;%s/realms/%s/account/#/resources&quot;, keycloakUrl, realm);
    }

    public String getResourceDetailUrl(String resourceId) {
        return String.format(&quot;%s/realms/%s/account/#/resources/%s&quot;,
            keycloakUrl, realm, resourceId);
    }
}</pre><p class="mb-4"><strong>Benefits of Using the Built-in Account Console</strong>:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2"><strong>Zero custom development:</strong> No need to build UI for permission management</li><li class="mb-2"><strong>Consistent UX:</strong> Users get a familiar, well-tested interface</li><li class="mb-2"><strong>Automatic updates:</strong> New Keycloak features appear automatically</li><li class="mb-2"><strong>Security:</strong> All permission operations go through Keycloak&#x27;s validated APIs</li><li class="mb-2"><strong>Audit trail:</strong> Keycloak logs all permission changes</li><li class="mb-2"><strong>Multi-language support:</strong> Account Console supports internationalization</li></ul><h2 class="text-2xl font-medium mt-8 mb-4">Decision Strategies and Policy Composition</h2><p class="mb-4">When multiple policies apply to a permission, Keycloak uses a decision strategy:</p><ul class="list-disc pl-6 mb-4"><li class="mb-2"><strong>Unanimous:</strong> All policies must grant access</li><li class="mb-2"><strong>Affirmative:</strong> At least one policy must grant access</li><li class="mb-2"><strong>Consensus:</strong> Majority of policies must grant access</li></ul><p class="mb-4">You can create complex authorization logic using aggregated policies. For example:</p><pre class="bg-gray-100 p-4 rounded-lg mb-4 overflow-x-auto text-sm">Permission: &quot;Sensitive Car Write&quot;
├─ Aggregated Policy (AND)
│  ├─ Owner Policy (must be owner)
│  └─ Time Policy (only business hours)
└─ Decision Strategy: Unanimous</pre><h2 class="text-2xl font-medium mt-8 mb-4">Performance Considerations</h2><p class="mb-4">Dynamic resource registration at scale requires careful consideration:</p><ol class="list-decimal pl-6 mb-4"><li class="mb-2"><strong>Caching:</strong> Cache authorization decisions at the API layer with short TTLs</li><li class="mb-2"><strong>Batch Operations:</strong> Register resources in batches when possible</li><li class="mb-2"><strong>Resource Cleanup:</strong> Implement lifecycle management to delete resources from Keycloak when cars are deleted</li><li class="mb-2"><strong>Database Indexing:</strong> Ensure your application maintains a mapping between business IDs and Keycloak resource IDs</li></ol><pre class="bg-gray-100 p-4 rounded-lg mb-4 overflow-x-auto text-sm">public class ResourceLifecycleManager {

    private final KeycloakResourceManager resourceManager;
    private final CarRepository carRepository;

    public void createCar(Car car, String ownerId) {
        // 1. Save to database
        carRepository.save(car);

        // 2. Register with Keycloak
        Map&lt;String, String&gt; attributes = new HashMap&lt;&gt;();
        attributes.put(&quot;manufacturer&quot;, car.getManufacturer());
        attributes.put(&quot;category&quot;, car.getCategory());
        attributes.put(&quot;year&quot;, String.valueOf(car.getYear()));

        String keycloakResourceId = resourceManager.registerResource(
            car.getId(),
            ownerId,
            attributes
        );

        // 3. Store mapping
        carRepository.updateKeycloakResourceId(car.getId(), keycloakResourceId);
    }

    public void deleteCar(String carId) {
        // 1. Get Keycloak resource ID
        String keycloakResourceId = carRepository.getKeycloakResourceId(carId);

        // 2. Delete from Keycloak
        if (keycloakResourceId != null) {
            resourceManager.deleteResource(keycloakResourceId);
        }

        // 3. Delete from database
        carRepository.delete(carId);
    }
}</pre><h2 class="text-2xl font-medium mt-8 mb-4">Conclusion</h2><p class="mb-4">Keycloak&#x27;s UMA implementation provides enterprise-grade fine-grained authorization for dynamic resource scenarios. By combining resource server configuration, dynamic resource registration, RBAC and ABAC policies, and Keycloak&#x27;s built-in Account Console, you can build systems where users safely manage their own access control policies without requiring custom UI development.</p><p class="mb-4">The architecture we&#x27;ve outlined separates concerns effectively: your application logic focuses on business operations, while Keycloak handles the complex authorization decisions using a standardized, auditable framework. The built-in Account Console eliminates the need for custom permission management UI while still allowing programmatic access when needed.</p><p class="mb-4">This approach scales from hundreds to millions of resources while maintaining consistent security policies. For production deployments, consider implementing comprehensive audit logging, monitoring policy evaluation latency, and establishing governance processes around policy creation and modification. The flexibility of Keycloak&#x27;s authorization services means you can start simple and evolve your authorization model as requirements grow more sophisticated.</p><div class="bg-gray-100 p-6 rounded-lg mt-8"><h3 class="text-xl font-medium mb-3">Want to Learn More?</h3><p class="mb-4">Explore Keycloak&#x27;s comprehensive documentation on authorization services and UMA implementation to dive deeper into fine-grained access control for your applications.</p><a href="https://www.keycloak.org/docs/latest/authorization_services/" class="inline-block bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700" target="_blank" rel="noopener noreferrer">Read Keycloak Documentation</a></div></article></div><footer class="py-8 px-6 border-t border-gray-200"><div class="max-w-4xl mx-auto"><div class="flex flex-col sm:flex-row justify-between items-center gap-4"><p class="text-gray-600 text-sm">© <!-- -->2026<!-- --> Hilberg IT Beratung. <!-- -->Alle Rechte vorbehalten.</p><div class="flex gap-6 text-sm"><a href="/blog" class="text-gray-600 hover:text-gray-900 link-hover">Blog</a><a href="/privacy" class="text-gray-600 hover:text-gray-900 link-hover">Datenschutzerklärung</a><a href="/imprint" class="text-gray-600 hover:text-gray-900 link-hover">Impressum</a></div></div></div></footer></div></div>
        
        <script id="vike_pageContext" type="application/json">{"locale":"de","urlPathnameWithoutLocale":"\\/blog\\/keycloak-uma","pageId":"\\/pages\\/blog\\/keycloak-uma","routeParams":{}}</script>
        <script id="vike_globalContext" type="application/json">{}</script>
        <script src="/assets/entries/entry-client-routing.uP97l9Ja.js" type="module" async></script>
        <link rel="modulepreload" href="/assets/entries/pages_blog_keycloak-uma.94o5ATJJ.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/assets/chunks/chunk-CUuCKY5k.js" as="script" type="text/javascript">
        <link rel="modulepreload" href="/assets/chunks/chunk-xUHxWF9R.js" as="script" type="text/javascript">
      </body>
    </html>